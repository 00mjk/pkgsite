<!--
        Copyright 2019 The Go Authors. All rights reserved.
        Use of this source code is governed by a BSD-style
        license that can be found in the LICENSE file.
-->
{{define "main_content"}}
<div class="Container">
  {{$header := .Header}}
  {{$namespace := .Namespace}}
  <header class="DetailsHeader">
    <div class="DetailsHeader-breadcrumb">
      {{.BreadcrumbPath}}
    </div>
    <div class="DetailsHeader-main">
      <h1 class="DetailsHeader-title">{{.Title}}</h1>
      <div class="DetailsHeader-version">{{$header.Version}}</div>

      {{- $mpath := $header.Path -}}
      {{- $ppath := "" -}}
      {{- if ne $namespace "mod" -}}
         {{- $mpath = $header.Module.Path -}}
         {{- $ppath = $header.Path -}}
      {{- end}}
      <!-- Do not reformat the data attributes of the following div: the server uses a regexp to extract them. -->
      <div class="DetailsHeader-badge $$GODISCOVERY_LATESTCLASS$$"
           data-version="{{$header.Version}}" data-mpath="{{$mpath}}" data-ppath="{{$ppath}}">
        {{$href := $header.Path}}
        {{if and (eq $namespace "mod") (ne $header.Path "std")}}
          {{$href = print "mod/" $href}}
        {{end}}
        <span>Latest</span>
        <a href="/{{$href}}@$$GODISCOVERY_LATESTVERSION$$">Go to latest</a>
      </div>
    </div>
    <div class="DetailsHeader-infoLabel">
      <span class="DetailsHeader-infoLabelTitle">Published:</span>
      <strong>{{$header.CommitTime}}</strong>
      <span class="DetailsHeader-infoLabelDivider">|</span>
      <span class="DetailsHeader-infoLabelTitle">{{pluralize (len $header.Licenses) "License"}}: </span>
      <span>
        {{range $i, $e := $header.Licenses -}}{{if $i}}, {{end}}
          <a href="{{$header.URL}}?tab=licenses#{{.Anchor}}">{{$e.Type}}</a>
        {{- else -}}
          <span>None detected</span>
          <a href="/license-policy" class="Disclaimer-link"><em>not legal advice</em></a>
        {{- end}}
      </span>
      {{if eq $namespace "pkg"}}
        <span class="DetailsHeader-infoLabelDivider">|</span>
        {{if eq $header.Module.Path "std"}}
          <a href="{{$header.Module.URL}}">Standard library</a>
        {{else}}
          <span class="DetailsHeader-infoLabelTitle">Module: </span>
          <span>
            <a href="{{$header.Module.URL}}">{{$header.Module.Path}}</a>
          </span>
        {{end}}
      {{end}}
    </div>
  </header>

  <nav class="DetailsNav js-modulesNav">
    <ul class="DetailsNav-list" role="tablist">
      {{range .Tabs}}
        <li class="{{if .Disabled}}DetailsNav-tabDisabled {{end}}DetailsNav-tab{{if eq .Name $.Settings.Name}} selected{{end}}" role="presentation">
          {{if .Disabled}}
            <a class="DetailsNav-link"
               role="tab"
               aria-selected="false">
          {{else if eq .Name $.Settings.Name}}
            <a class="DetailsNav-link"
               role="tab"
               aria-selected="true">
          {{else}}
            <a class="DetailsNav-link"
               href="{{$header.URL}}?tab={{.Name}}"
               role="tab"
               aria-selected="false">
          {{end}}
          {{.DisplayName}}
          </a>
        </li>
      {{end}}
    </ul>
  </nav>

  <div class="DetailsContent">
    {{if .CanShowDetails -}}
      {{template "details_content" .Details}}
    {{- else}}
      <h2>“{{.Settings.DisplayName}}” not displayed due to license restrictions.</h2>
    {{end}}
  </div>
</div>
{{end}}

{{define "post_content"}}
<script nonce="{{.Nonce}}">
const navEl = document.querySelector('.js-modulesNav');
const selectedEl = navEl.querySelector(`[aria-selected='true']`);
if (selectedEl.offsetLeft + selectedEl.offsetWidth > navEl.offsetWidth) {
  navEl.scrollLeft = selectedEl.offsetLeft;
}

const copyButton = document.querySelector('#DetailsHeader-copyPath');
if (copyButton) {
  copyButton.addEventListener('click', function(event) {
    event.preventDefault();
    const input = document.querySelector('#DetailsHeader-path');
    input.select();
    document.execCommand('copy');
    input.blur(); // prevents jump to focused element in some browsers
  });
}
</script>

{{block "details_post_content" .}}{{end}}
{{end}}
